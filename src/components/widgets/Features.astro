---
import WidgetWrapper from "./WidgetWrapper.astro";
import type { FeaturesProps } from "../../types/types";
import { Icon } from "astro-icon/components";
import Headline from "../ui/Headline.astro";

const {
    features = [],
    columns = 3,
    title,
    subtitle,
    tagline,
    id,
    isDark = false,
    classes = {},
    headlineAlign = "center",
    bg = await Astro.slots.render("bg"),
} = Astro.props as FeaturesProps;

const { container: containerClassProp = "", ...otherClasses } = classes;

const gridColsClass: Record<number, string> = {
    1: "md:grid-cols-1",
    2: "md:grid-cols-2",
    3: "md:grid-cols-3",
    4: "md:grid-cols-4",
};
const gridClass = gridColsClass[columns] || "md:grid-cols-3";
---

<WidgetWrapper
    id={id}
    isDark={isDark}
    containerClass={` ${containerClassProp}`}
    bg={bg}
    classes={otherClasses}
>
    <Headline
        title={title}
        subtitle={subtitle}
        tagline={tagline}
        classes={{
            container: `max-w-3xl mb-10 md:mb-14 ${headlineAlign === "left" ? "" : "mx-auto text-center"}`,
        }}
    />
    <div class={`grid grid-cols-1 ${gridClass} gap-6`}>
        {
            features.map((feature, i) => (
                <div
                    class:list={[
                        "group relative bg-card/60 backdrop-blur-sm p-8 rounded-3xl border border-border/50 transition-all duration-300 hover:border-primary/30 hover:shadow-[var(--shadow-gold-card)] overflow-hidden",
                        i === 0 && "md:col-span-2",
                    ]}
                >
                    {/* Large decorative icon background */}
                    {feature.icon && (
                        <div class="absolute top-4 right-4 opacity-[0.06] transition-transform duration-500 group-hover:rotate-12">
                            <Icon name={feature.icon} class="w-24 h-24 text-primary" />
                        </div>
                    )}

                    {/* Gold accent top line */}
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-1/3 h-[2px] bg-gradient-to-r from-transparent via-primary to-transparent rounded-full"></div>

                    {/* Functional icon */}
                    {feature.icon && (
                        <div
                            class={`w-12 h-12 rounded-xl flex items-center justify-center mb-6 relative z-10 ${feature.iconClass || "bg-primary/10 text-primary"}`}
                        >
                            <Icon name={feature.icon} class="w-6 h-6" />
                        </div>
                    )}
                    <h3 class="text-xl font-bold text-foreground mb-3 relative z-10">
                        {feature.title}
                    </h3>
                    <p class="text-muted-foreground text-sm relative z-10">
                        {feature.description}
                    </p>
                </div>
            ))
        }
    </div>
</WidgetWrapper>
