---
import WidgetWrapper from "./WidgetWrapper.astro";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import SectionTitle from "../ui/SectionTitle.astro";
import Button from "../ui/Button.astro";
import type { ContentProps } from "../../types/types";

const {
    title,
    subtitle,
    tagline,
    description = [],
    image,
    imageAlt = "",
    actions = [],
    isReversed = false,
    id,
    isDark = false,
    classes = {},
    bg = await Astro.slots.render("bg"),
    items = [],
    isAfterContent = false,
} = Astro.props as ContentProps;

const { container: containerClassProp = "", ...otherClasses } = classes;
---

<WidgetWrapper
    id={id}
    isDark={isDark}
    containerClass={`max-w-7xl mx-auto ${containerClassProp}`}
    bg={bg}
    classes={otherClasses}
>
    <div
        class={`mx-auto max-w-7xl ${image ? `${isReversed ? "md:flex-row-reverse" : ""} md:flex items-center` : ""}`}
    >
        <div class={image ? "md:basis-1/2 self-center text-left relative z-10 md:-mr-12" : "max-w-3xl mx-auto text-left"}>
            <SectionTitle
                badge={tagline}
                title={title}
                subtitle={subtitle ||
                    (Array.isArray(description)
                        ? description.join(" ")
                        : description)}
                align="left"
                class="mb-8"
            />

            {/* Slot before items if not isAfterContent */}
            {!isAfterContent && <slot />}

            {
                items && items.length > 0 && (
                    <div class="space-y-6 my-8">
                        {items.map(
                            ({
                                title: titleItem,
                                description: descriptionItem,
                            }, idx) => (
                                <div class="flex items-start gap-4">
                                    {/* Gold number */}
                                    <span class="text-2xl font-extrabold text-primary/40 font-mono leading-none mt-1 shrink-0">
                                        {String(idx + 1).padStart(2, "0")}
                                    </span>
                                    {/* Horizontal line + content */}
                                    <div class="flex-1">
                                        <div class="w-8 h-px bg-primary/30 mb-3"></div>
                                        {titleItem && (
                                            <h3 class="text-lg font-medium leading-6">
                                                {titleItem}
                                            </h3>
                                        )}
                                        {descriptionItem && (
                                            <p class="mt-2 text-muted-foreground">
                                                {descriptionItem}
                                            </p>
                                        )}
                                    </div>
                                </div>
                            ),
                        )}
                    </div>
                )
            }
            {
                Array.isArray(actions) && actions.length > 0 && (
                    <div class="mt-8 flex flex-col sm:flex-row gap-4">
                        {actions.map((action) => (
                            <Button
                                href={action.href}
                                variant={
                                    action.variant as "primary" | "secondary"
                                }
                                aria-label={action.ariaLabel}
                                class="w-full sm:w-auto"
                            >
                                {action.icon && (
                                    <Icon
                                        name={action.icon}
                                        class="w-5 h-5 mr-2 -ml-1"
                                    />
                                )}
                                {action.text}
                            </Button>
                        ))}
                    </div>
                )
            }

            {/* Slot after items if isAfterContent */}
            {isAfterContent && <slot />}
        </div>
        <div class="md:basis-1/2 self-center mt-10 md:mt-0" aria-hidden="true">
            {
                image && (
                    <div class="relative m-auto max-w-4xl">
                        <Image
                            src={image}
                            alt={imageAlt}
                            class="mx-auto w-full rounded-3xl border-l-4 border-primary shadow-lg"
                        />
                    </div>
                )
            }
        </div>
    </div>
</WidgetWrapper>
