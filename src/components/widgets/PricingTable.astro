---
import WidgetWrapper from "./WidgetWrapper.astro";
import Headline from "../ui/Headline.astro";
import Button from "../ui/Button.astro";
import type { PricingTableProps } from "../../types/types";

const {
    tiers,
    title,
    subtitle,
    tagline,
    id,
    isDark = false,
    classes = {},
    bg,
} = Astro.props as PricingTableProps;
---

<WidgetWrapper id={id} isDark={isDark} bg={bg} classes={classes}>
    <Headline
        title={title}
        subtitle={subtitle}
        tagline={tagline}
        titleAs="h2"
        classes={{
            container: "mb-12 text-center",
            title: "text-4xl md:text-5xl font-medium tracking-tight font-display",
            subtitle: "text-lg text-muted-foreground max-w-2xl mx-auto",
        }}
    />
    <div class="grid gap-8 md:grid-cols-3">
        {
            tiers.map((tier) => (
                <div
                    class:list={[
                        "relative bg-card/60 backdrop-blur-sm rounded-3xl p-8 transition-all duration-300 border overflow-hidden",
                        tier.highlighted
                            ? "border-t-4 border-primary shadow-[0_0_40px_rgba(212,168,83,0.10)] scale-[1.05]"
                            : "border-border/50 hover:border-primary/30",
                    ]}
                >
                    {/* Header gradient */}
                    <div class="absolute top-0 inset-x-0 h-24 bg-gradient-to-b from-primary/5 to-transparent pointer-events-none" aria-hidden="true"></div>

                    {tier.highlighted && (
                        <div class="absolute -top-0 left-1/2 -translate-x-1/2 bg-primary text-background text-xs font-bold px-4 py-1 rounded-b-full">
                            {tier.popularLabel || "Populaire"}
                        </div>
                    )}
                    <div class="relative z-10">
                        <h3 class="text-xl font-bold text-foreground mb-2 mt-4">
                            {tier.name}
                        </h3>
                        <p class="text-sm text-muted-foreground mb-6">
                            {tier.description}
                        </p>
                        <div class="mb-6">
                            <span class:list={[
                                "text-5xl font-extrabold",
                                tier.highlighted ? "text-gradient-gold" : "text-primary",
                            ]}>
                                {tier.price}
                            </span>
                            {tier.priceNote && (
                                <span class="text-sm text-muted-foreground ml-1">
                                    {tier.priceNote}
                                </span>
                            )}
                        </div>
                        <ul class="space-y-3 mb-8">
                            {tier.features.map((feature) => (
                                <li class="flex items-start gap-3 text-sm text-foreground/80">
                                    <span class="w-1.5 h-1.5 rounded-full bg-primary mt-1.5 shrink-0" aria-hidden="true"></span>
                                    {feature}
                                </li>
                            ))}
                        </ul>
                        <Button
                            href={tier.cta.href}
                            variant={tier.highlighted ? "primary" : "secondary"}
                            class="w-full"
                        >
                            {tier.cta.text}
                        </Button>
                    </div>
                </div>
            ))
        }
    </div>
</WidgetWrapper>
